## 4.1 数据库设计概述
### 一、数据库设计方案
数据库设计是数据库应用系统开发的重要内容。在实现数据库之前，必须有明确的设计方案。
1. #数据库应用架构设计 在不同应用需求场景中，数据库的应用架构方式是不同的。数据库应用架构可分为 #单用户结构 、 #集中式结构 、 #客户/服务器结构 和 #分布式结构 。
2. #数据库结构模型设计 一般分为 概念层、逻辑层、物理层设计，它们的设计模型分别为 
	1. #概念数据模型 （Concept Data Model，CDM）是一种面向用户的系统数据模型，它用来描述现实世界的系统概念化数据结构。使数据库设计人员在系统设计的初始阶段，摆脱计算机系统及DBMS的具体技术问题，集中精力分析业务数据以及数据之间的联系等，描述系统的数据对象及其组成关系。
	2. #逻辑数据模型 （Logic Data Model，LDM）是在概念数据模型基础上，从系统设计角度描述系统的数据对象及其关联结构，并考虑这些数据对象复合数据库对象的逻辑表示。
	3. #物理数据模型 （Physical Data Model，PDM）是在逻辑数据模型基础上，针对具体DBMS所设计的数据模型。它用于描述系统数据模型在具体DBMS中的数据对象组织、存储方式、索引方式、访问路径等实现信息。
3. #数据库应用访问方式设计 数据库应用对数据库访问可以有多种方式，如直接 #本地接口 连接访问、基于 #标准结构 连接访问、基于 #数据访问层框架 连接访问。
### 二、数据库开发过程及设计策略
1. 数据需求分析阶段
	- 从现实业务获取数据表单、报表、查询、业务规则、数据更新的说明
	- 分析系统的数据特征、数据类型、数据取值约束
	- 描述系统的数据关系、数据处理要求
	- 建立系统的数据字典
2. 数据库设计阶段
	- 数据库模型结构设计（概念数据模型、逻辑数据模型、物理数据模型）
	- 数据库索引、视图、查询设计
	- 数据库表约束设计
	- 数据库触发器、存储过程设计
3. 数据库实现阶段
	- 数据库创建
	- 数据模型物理实现
4. 数据库测试阶段
	- 数据库数据上线
	- 数据库系统测试
5. 设计策略
	- 自下而上
	- 自上而下
	- 由内向外
	- 混合设计
### 三、主流数据库建模工具Power Designer
1. Power Designer是一种面向软件开发生命周期的建模工具，它提供软件需求模型、业务流程模型、数据库模型、面向对象模型、自定义模型的开发支持。
2. Power Designer的数据建模工具特点：
	- 功能强大的软件开发生命周期建模工具
	- 支持目前主流的数据库管理系统（如Oracle、SYBASE、SQL Server、DB2、Mysql、PosetgreSQL等）
	- 支持目前多种客户端开发工具（如PB、VB、VC、Delphi等）
	- 满足大、中、小型数据库建模设计
3. Power Designer可建立的数据模型
	- 概念数据模型（Conceptual Data Model, CDM），从用户角度所建模的系统数据对象及其关系，它帮助用户分析信息系统的数据结构关系。
	- 逻辑数据模型（Logic Data Model, LDM），从系统分析员角度所建模的系统数据对象逻辑结构关系，它帮助开发人员分析信息系统的逻辑数据结构。
	- 物理数据模型（Physical Data Model, PDM），从系统设计人员角度所建模的系统数据物理存储及结构关系，它针对设计者具体定义信息系统的数据库表结构。
## 4.2 E-R模型方法

### 一、E-R模型
1. #E-R模型 是实体-联系模型（Entity-Relationship Model）的简称。它是一种设计系统概念数据模型、逻辑数据模型的有效方法。E-R模型最早由美籍华人计算机科学家Peter Chen（陈品山）于1976年提出，该模型方法在数据库设计领域得到了广泛的使用。大部分数据库设计工具产品均支持使用E-R模型方法进行数据库概念数据模型与逻辑数据模型设计。
2. 在E-R模型中，基本元素包括实体、属性、标识符和联系。
	1. #实体 （Entity）是指问题域中存在的人、事、物、地点等客观事物在逻辑层面的数据抽象。它用于描述事物的数据对象，如客户、交易、产品、订单等。
	2. #属性 是指描述实体特征的数据项。每个实体都具有1个或多个属性。
	3. #标识符 是指标识不同实体实例的属性。标识符可以是1个或多个属性。标识符与主键的区别是标识符是逻辑概念，主键是物理概念。
	4. #联系 （Relationship）是指实体之间的联系，如“学生”和“成绩”的联系、“孩子”和“父亲”、“母亲”的联系等。联系中关联的实体数目称为 #联系度数 。
3. 实体之间的联系反映了一个给定实体有多少实例与另一实体实例存在的数量对应关系。通常采用术语 #基数 （Cardinality）来表示。
4. 二元实体-联系类型：
	- 1对1 (1:1)
	- 1对多 (1:N) 其中1是 #最小基数 ，N是 #最大基数
	- 多对多 (M:N)
5. 在实体之间除了需要反映数量对应关系，有时还需要反映实体参与关系的必要性，即 #可选 （optional）或 #强制 （mandatory）。（是否为必填项）
### 二、实体继承联系
1. 在E-R模型中，实体之间除了基本联系外，还存在 #继承联系 。继承联系用于表示实体之间的相似性关系。在实体继承联系中，一端是具有公共属性的实体，称为 #父实体 ；另一端是与父实体具有相似属性，同时也具有特殊性的一个或多个实体，称为 #子实体 。
2. 在继承联系中，还可以分为 #互斥性继承联系 和 #非互斥性继承联系 。
3. 除了互斥和非互斥的分类外，继承联系还可以分为 #完整继承 和 #非完整继承 。如果父实体实例必须属于子实体中的某一个，则称为完整继承联系；否则是非完整继承联系。
4. 在E-R模型中，按照实体之间的语义关系，可以将实体分为弱实体和强实体。 #弱实体 是指那些对于另外实体有依赖关系的实体，即一个实体的存在必须以另一实体的存在为前提。而被依赖的实体称为 #强实体 。
5. 在E-R模型中，根据弱实体在语义上对强实体依赖程度的不同，弱实体又分为标识符（ID）依赖弱实体和非标识符（非ID）依赖弱实体两类。
	1. 如果弱实体的标识符中含有所依赖实体的标识符，则该弱实体称为 #标识符（ID）依赖弱实体 。
	2. 在有依赖联系的弱实体中，并非所有弱实体都是标识符依赖弱实体，它们可以有自己的标识符，这样的弱实体即为 #非标识符（非ID）依赖弱实体 。
6. 鸟足版本实体-联系图
## 4.3 数据库建模设计
1. #概念数据模型设计 是通过对现实世界中数据实体进行抽取、分类、聚集和概括等处理，建立反映系统业务数据组成结构的过程。概念数据模型设计一般是采用E-R模型方法进行建模设计。
2. 概念数据模型设计步骤
	- 业务数据分析，抽取数据实体
	- 定义实体属性及其标识
	- 建立实体联系，构建局部E-R模型图
	- 分类、聚集和概括各个部分E-R模型图
	- 完善全局E-R模型图，建立系统业务数据组成结构
3. 数据库结构模型设计分为概念数据模型设计、逻辑数据模型设计、物理数据模型设计三个层次。在常规的数据库设计中，将依次对这三种模型进行设计，其中包括不同层次模型之间的转换设计。 

| 概念数据模型           | 逻辑数据模型                                     | 关系数据库的物理数据模型               |
| ---------------- | ------------------------------------------ | -------------------------- |
| 实体（Entity）       | 实体（Entity）                                 | 表（Table）                   |
| 属性（Attribute）    | 属性（Attribute）                              | 列（Column）                  |
| 标识符（Identifier）  | 标识符（Primary Identifier/Foreign Identifier） | 键（Primary Key/Foreign Key） |
| 联系（Relationship） | 联系（Relationship）                           | 参照完整性约束（Reference）         |
4. 当使用关系数据库时，物理数据模型即为关系模型。CDM/LDM到PDM的转换其实就是E-R模型到关系模型的转换。E-R模型到关系模型转换原理：
	1. 将每一个实体转换成一个关系表，实体属性转换为关系表的列，实体标识符转换为关系表的主键或外键。
	2. 将实体之间的联系转化为关系表之间的参照完整性约束。
	3. 弱实体转换为关系表时，需要特别处理。
		1. 非ID依赖弱实体转换为关系表时，往往会在弱实体转化的关系表中增加外键属性列。
		2. ID依赖弱实体转换为关系表时，表中的主键同时兼为外键。
5. **实体联系**转换参照完整性约束
	1. 1:1实体联系转换表示
		- 一种是将学生表的主键学号放入助学金账号表中做外键。
		- 另一种是将助学金账号表的主键账号放入学生表中做外键。
		- 一般会把弱实体的主键放到强实体转换的关系表中做外键。
	2. 1:N实体联系转换表示： 两个实体分别转换为关系表，然后将父实体关系表的主键放入子实体关系表中做外键，便可将1:N实体联系转换为关系表参照完整性约束。
	3. M:N实体联系转换表示：M:N实体联系不能像1:1和1:N实体联系那样直接转换。需要创建一个新的关联表，该关联表分别参照原有实体对应的关系表。
6. 当带有**实体继承联系**的E-R模型转换为关系模型时，首先父实体和子实体都各自转换为表，其属性均转换为表的列。在处理实体继承联系转换时，将父表中的主键放置到子表中，既做主键又做外键。
7. **实体递归联系**转换参照完整性约束
	1. 1:N实体递归联系的转换：首先将递归实体转换为表，其属性转换为列，标识符转换为主键，同时还将标识符转换为外键，实现自己对自己的参照。
	2. M:N实体递归联系的转换：增加一个关联表，该表分别参照原实体对应的关系表，并对原关系表建立两个参照完整性约束。
## 4.4 数据库规范化设计
### 一、数据库规范化设计
1. 数据库规范化设计目标
	- 减少数据库中的冗余数据，尽量使同一数据在数据库中仅保存一份，有效降低维护数据一致性的工作量。
	- 设计合理的表间依赖关系和约束关系，便于实现数据完整性和一致性。
	- 设计合理的数据库结构，便于系统对数据高效访问处理。
2. 非规范化关系表的数据操作问题：不规范的关系表可能存在数据冗余，引出数据访问操作异常现象，难以使数据库保持数据的一致性。
### 二、函数依赖理论
1. 函数依赖的数学定义：设有一关系模式R(U)，U为关系R的属性集合，X和Y为属性U的子集。设t, s是关系R中的任意两个元组，如果$t[X]=s[X],t[Y]=s[Y]$。那么称 ”Y函数[[1.1 命题与联结词#^6690a7|依赖]]于X“ ，表示为 $X\to Y$。函数依赖的左部称为 #决定因子 ，右部称为 #依赖函数 。决定因子和依赖函数都是属性的集合。
	- 说明：函数依赖反映属性或属性组之间相互依存、相互制约的关系，即关系表中属性之间的依赖关系。
2. 函数依赖的类型
	- 完全函数依赖：设X、Y是某关系的不同属性集，如 $X\to Y$，且不存在 $X'\subset X$，使 $X'\to Y$，则称Y为 #完全函数依赖 ，否则称Y #部分函数依赖 。
	- 部分函数依赖
	- 属性传递依赖：设X、Y、Z是某关系的不同属性集，有 $X\to Y,Y\not\to X,Y\to Z$，则称Z对X存在 #函数传递依赖 。
	- 多值函数依赖：设U是关系模式R的属性集，X和Y是U的子集，Z=U-X-Y，xyz表示属性集XYZ的值。对于R的关系r，在r中存在元组(x,y1,z1)和(x,y2,z2)时，也存在元组(x,y1,z2)和(x,y2,z1)，那么在模式R上存在 #多值函数依赖 。
### 三、关系规范化范式

#关系规范化 是把一个有访问异常的关系分解成结构良好的关系，使得这些关系有最小的冗余或没有冗余。 #规范化范式 （Normal Form，NF）是指关系表符合特定规范化程度的模式。
1. #第1范式 （ #1NF ） ：如果关系表中的属性不可再细分，该关系满足第1范式。反之，该表就不是关系表。
2. #第2范式 （ #2NF ）：如果关系满足第1范式，并消除了关系中的属性部分函数依赖，该关系满足第2范式。
3. #第3范式 （ #3NF ）：如果关系满足第2范式，并切断了关系中的属性传递函数依赖，该关系满足第3范式。
4. #巴斯-科德范式 （ #BCNF ）：在关系中，所有函数依赖的决定因子都是候选键，该关系满足BCNF范式。
5. #第4范式 （ #NF ）：如果关系满足BCNF范式，并消除了多值函数依赖，该关系满足第4范式。
6. 关系规范化程度依次提升：$1NF\to 2NF\to 3NF\to BNCF\to 4NF$。关系的规范化程度越高，关系数据库存储的冗余数据就越少，可消除的数据访问异常就越多。不过关系的规范化程度越高，分解出来的关系表就越多，但实现数据查询访问时，需关联多表，其效率降低。
7. 规范化减少了数据冗余，易于保证数据的完整性，但规范化过高也会导致数据库性能降低，因此，在利用规范化设计数据库时要平衡两者的关系。为此，有人又提出了逆规范化处理的思想。 #逆规范化 就是适当降低规范化范式约束，不再要求一个关系表必须达到很高的规范化程度，而是允许适当的数据冗余性，以获取数据访问性能。逆规范化处理的基本方法：
	1. 增加冗余列或派生列
	2. 多个关系表合并为一个关系表
## 4.5 数据库设计模型SQL实现
在完成数据库设计后，基于物理数据模型，进行数据库对象实现，可以有两种方式：
1. GUI方式创建数据库对象：基于物理数据模型设计，在数据库管理工具中，通过GUI操作方式实现各个数据库对象的创建。
	- 不需要SQL编程
	- 直观的可视化操作
	- 需要大量手工操作
	- 数据库修改麻烦
2. 执行SQL脚本程序创建数据库对象：将设计的物理数据模型生成数据库对象创建的SQL脚本程序，由数据库管理工具将该SQL程序提交数据库服务器执行，实现各个数据库对象的创建。
	- 数据库对象创建高效、快速
	- 设计模型修改可方便地同步数据库实现
	- 需要理解SQL编程